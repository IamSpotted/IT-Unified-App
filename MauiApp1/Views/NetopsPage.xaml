<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:controls="clr-namespace:MauiApp1.Controls"
             x:Class="MauiApp1.Views.NetopsPage"
             Title="{Binding Title}"
             BackgroundColor="{StaticResource PageBackgroundBrush}">
    
    <Grid RowDefinitions="Auto,*">
        
        <!-- Application Header -->
        <controls:AppHeader Grid.Row="0" />
        
        <!-- Content -->
        <Grid Grid.Row="1" RowDefinitions="Auto,*">
        
            <!-- Filter Controls -->
            <ScrollView Grid.Row="0" Orientation="Horizontal" Padding="10">
                <StackLayout Orientation="Horizontal" Spacing="10">
                    
                    <!-- Area Filter -->
                    <StackLayout>
                        <Label Text="Area" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableAreas}"
                                SelectedItem="{Binding SelectedArea}"
                                WidthRequest="100" />
                    </StackLayout>
                    
                    <!-- Zone Filter -->
                    <StackLayout>
                        <Label Text="Zone" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableZones}"
                                SelectedItem="{Binding SelectedZone}"
                                WidthRequest="100" />
                    </StackLayout>
                    
                    <!-- Line Filter -->
                    <StackLayout>
                        <Label Text="Line" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableLines}"
                                SelectedItem="{Binding SelectedLine}"
                                WidthRequest="80" />
                    </StackLayout>

                    <!-- Pitch Filter -->
                    <StackLayout>
                        <Label Text="Pitch" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailablePitches}"
                                SelectedItem="{Binding SelectedPitch}"
                                WidthRequest="100" />
                    </StackLayout>
                    
                    <!-- Column Filter -->
                    <StackLayout>
                        <Label Text="Column" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableColumns}"
                                SelectedItem="{Binding SelectedColumn}"
                                WidthRequest="80" />
                    </StackLayout>
                    
                    <!-- Level Filter -->
                    <StackLayout>
                        <Label Text="Level" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableLevels}"
                                SelectedItem="{Binding SelectedLevel}"
                                WidthRequest="100" />
                    </StackLayout>

                    <!-- Type Filter -->
                    <StackLayout>
                        <Label Text="Type" FontSize="12" HorizontalOptions="Center" />
                        <Picker ItemsSource="{Binding AvailableTypes}"
                                SelectedItem="{Binding SelectedType}"
                                WidthRequest="120" />
                    </StackLayout>
                    
                    <!-- Action Buttons -->
                    <StackLayout Orientation="Horizontal" Spacing="5" VerticalOptions="End">
                        <Button Text="ðŸ”„ Refresh" 
                                Command="{Binding LoadNetopsCommand}"
                                FontSize="12" 
                                Padding="10,5" />
                        <Button Text="ðŸ—‘ï¸ Clear" 
                                Command="{Binding ClearFiltersCommand}"
                                FontSize="12" 
                                Padding="10,5" />
                    </StackLayout>
                    
                    <!-- Search Bar -->
                    <StackLayout Spacing="5" VerticalOptions="End" Margin="10,0,0,0">
                        <Label Text="Search" FontSize="12" HorizontalOptions="Center" />
                        <Entry Text="{Binding SearchText}"
                               Placeholder="Search netops..."
                               WidthRequest="200"
                               FontSize="12" />
                    </StackLayout>

                    <!-- Restart Netop Controls -->
                    <StackLayout Spacing="5" VerticalOptions="End" Margin="10,0,0,0">
                        <Label Text="Restart Netop" FontSize="12" HorizontalOptions="Center" />
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Entry Text="{Binding RestartTarget}"
                                Placeholder="Enter Name/IP"
                                WidthRequest="140"
                                FontSize="12"
                                IsEnabled="{Binding IsRestarting, Converter={StaticResource InvertedBoolConverter}}"
                                ReturnType="Done"
                                ReturnCommand="{Binding RestartNetOpServiceCommand}" />
                            <Button Text="ðŸ”„" 
                                    Command="{Binding RestartNetOpServiceCommand}"
                                    FontSize="12" 
                                    Padding="8,5"
                                    WidthRequest="35"
                                    IsEnabled="{Binding IsRestarting, Converter={StaticResource InvertedBoolConverter}}" />
                            <ActivityIndicator IsRunning="{Binding IsRestarting}"
                                                IsVisible="{Binding IsRestarting}"
                                                WidthRequest="20"
                                                HeightRequest="20"
                                                VerticalOptions="Center" />
                        </StackLayout>
                        <Label Text="{Binding RestartStatusMessage}"
                            FontSize="10"
                            HorizontalOptions="Center"
                            WidthRequest="200"
                            LineBreakMode="WordWrap"
                            IsVisible="{Binding RestartStatusMessage, Converter={StaticResource StringToBoolConverter}}"
                            TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" />
                    </StackLayout>

                    <!-- Direct Connection -->
                    <StackLayout Spacing="5" VerticalOptions="End" Margin="10,0,0,0">
                        <Label Text="Connect to Device" FontSize="12" HorizontalOptions="Center" />
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Entry Text="{Binding ConnectToTarget}"
                                   Placeholder="Computer name/IP..."
                                   WidthRequest="140"
                                   FontSize="12"
                                   IsEnabled="{Binding IsRestarting, Converter={StaticResource InvertedBoolConverter}}"
                                   ReturnType="Done"
                                   ReturnCommand="{Binding DirectConnectCommand}" />
                            <Button Text="ðŸ”„"
                                    Command="{Binding DirectConnectCommand}"
                                    FontSize="12"
                                    Padding="8,5"
                                    WidthRequest="35"
                                    IsEnabled="{Binding IsRestarting, Converter={StaticResource InvertedBoolConverter}}" />
                            <ActivityIndicator IsRunning="{Binding IsRestarting}"
                                               IsVisible="{Binding IsRestarting}"
                                               WidthRequest="20"
                                               HeightRequest="20"
                                               VerticalOptions="Center" />
                        </StackLayout>
                        <Label Text="{Binding RestartStatusMessage}"
                               FontSize="10"
                               HorizontalOptions="Center"
                               WidthRequest="200"
                               LineBreakMode="WordWrap"
                               IsVisible="{Binding RestartStatusMessage, Converter={StaticResource StringToBoolConverter}}" />
                    </StackLayout>
                    
                </StackLayout>
            </ScrollView>

            <!-- Main Content -->
            <Grid Grid.Row="1">
                <ScrollView Padding="10">
                    <CollectionView ItemsSource="{Binding FilteredItems}"
                                    SelectionMode="None"
                                    BackgroundColor="Transparent">
                        <CollectionView.ItemsLayout>
                            <GridItemsLayout x:Name="NetopGridLayout"
                                             Orientation="Vertical"
                                             Span="{Binding GridSpan}"
                                             HorizontalItemSpacing="10"
                                             VerticalItemSpacing="10" />
                        </CollectionView.ItemsLayout>
                    
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2B2B2B}"
                                       BorderColor="{Binding IsOnline, Converter={StaticResource BoolToColorConverter}}"
                                       CornerRadius="8"
                                       Padding="10"
                                       HasShadow="True">
                                    <Frame.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectNetopCommand}"
                                                              CommandParameter="{Binding}" />
                                    </Frame.GestureRecognizers>
                                    
                                    <StackLayout Spacing="5">
                                        <Label Text="ðŸ“¹"
                                               FontSize="24"
                                               HorizontalOptions="Center" />
                                               
                                        <Label Text="{Binding StatusIcon}"
                                               FontSize="16"
                                               HorizontalOptions="End"
                                               VerticalOptions="Start" />
                                               
                                        <Label Text="{Binding Hostname, Converter={StaticResource HostnameFormatConverter}}"
                                               FontSize="14"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"
                                               LineBreakMode="TailTruncation" />
                                               
                                        <Label Text="{Binding PrimaryIp}"
                                               FontSize="12"
                                               HorizontalOptions="Center"
                                               TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" />
                                               
                                        <Label Text="{Binding FullLocation}"
                                               FontSize="10"
                                               HorizontalOptions="Center"
                                               TextColor="{AppThemeBinding Light=#999999, Dark=#AAAAAA}"
                                               LineBreakMode="TailTruncation" />
                                               
                                        <Label Text="{Binding Model}"
                                               FontSize="9"
                                               HorizontalOptions="Center"
                                               TextColor="{AppThemeBinding Light=#AAAAAA, Dark=#888888}"
                                               LineBreakMode="TailTruncation" />
                                    </StackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        
                        <CollectionView.EmptyView>
                            <StackLayout VerticalOptions="Center" HorizontalOptions="Center" Padding="50">
                                <Label Text="ðŸ“¹" FontSize="48" HorizontalOptions="Center" />
                                <Label Text="No netops found" 
                                       FontSize="18" 
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center" />
                                <Label Text="Try adjusting your filters or refresh the list"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       TextColor="{AppThemeBinding Light=#666666, Dark=#CCCCCC}" />
                                <Button Text="Refresh Netops"
                                        Command="{Binding LoadNetopsCommand}"
                                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                                        HorizontalOptions="Center"
                                        Margin="0,20,0,0" />
                            </StackLayout>
                        </CollectionView.EmptyView>
                    </CollectionView>
                </ScrollView>
                
                <!-- Loading Indicator -->
                <Frame IsVisible="{Binding IsBusy}"
                       BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}"
                       HorizontalOptions="Fill"
                       VerticalOptions="Fill"
                       BorderColor="Transparent">
                    <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <ActivityIndicator IsRunning="{Binding IsBusy}"
                                           Color="{StaticResource Primary}"
                                           WidthRequest="50"
                                           HeightRequest="50" />
                        <Label Text="Loading netops..."
                               FontSize="16"
                               HorizontalOptions="Center"
                               Margin="0,10,0,0" />
                    </StackLayout>
                </Frame>
            </Grid>
            
        </Grid>
        
    </Grid>
    
</ContentPage>
